<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å¥åº·å½•å…¥ - æ™ºä¼´é“¶é¾„</title>
    <style>
        /* å¸ƒå±€æ ·å¼ä¼˜åŒ– */
        body { display: flex; margin: 0; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; height: 100vh; }
        .sidebar { width: 240px; background: #001529; color: white; display: flex; flex-direction: column; }
        .sidebar h2 { padding: 20px; text-align: center; border-bottom: 1px solid #1f2d3d; margin: 0; }
        
        /* è¿™é‡Œçš„æ ·å¼å¯¹åº” div çš„ç‚¹å‡»æ•ˆæœ */
        .menu-item { padding: 15px 25px; color: #a6adb4; cursor: pointer; transition: 0.3s; text-decoration: none; }
        .menu-item:hover, .active-menu { color: white !important; background: #1890ff !important; }
        
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px; }
        
        label { display: block; margin-bottom: 10px; font-weight: bold; color: #333; }
        select, input { width: 100%; padding: 12px; margin-bottom: 25px; border: 1px solid #d9d9d9; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        button { width: 100%; padding: 12px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background: #40a9ff; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>æ™ºä¼´é“¶é¾„</h2>
        <div class="menu-item" onclick="location.href='home.html'">ğŸ  é¦–é¡µæ¦‚è§ˆ</div>
        <div class="menu-item active-menu" onclick="location.href='health-add.html'">ğŸ“ å¥åº·è®°å½•å½•å…¥</div>
        <div class="menu-item" onclick="location.href='medication.html'">ğŸ’Š æœè¯è®°å½•ç»Ÿè®¡</div>
        <div class="menu-item" onclick="location.href='alerts.html'">âš ï¸ å¼‚å¸¸æé†’ä¸­å¿ƒ</div>
        <div class="menu-item" style="margin-top: auto; border-top: 1px solid #1f2d3d;" onclick="logout()">ğŸšª é€€å‡ºç™»å½•</div>
    </div>

    <div class="main">
        <h3>æ–°å¢å¥åº·è®°å½•</h3>
        <div class="card">
            <label>æŒ‡æ ‡ç±»å‹ (healthType)</label>
            <select id="healthType">
                <option value="è¡€å‹">è¡€å‹</option>
                <option value="è¡€ç³–">è¡€ç³–</option>
                <option value="å¿ƒç‡">å¿ƒç‡</option>
                <option value="ä½“æ¸©">ä½“æ¸©</option>
            </select>
            
            <label>æŒ‡æ ‡æ•°å€¼ (healthValue)</label>
            <input type="text" id="healthValue" placeholder="ä¾‹å¦‚: 120/80 (è¡€å‹) æˆ– 6.5 (è¡€ç³–)">
            
            <label>è®°å½•æ–¹å¼ (recordWay)</label>
            <select id="recordWay">
                <option value="1">æ‰‹åŠ¨å½•å…¥</option>
                <option value="2">è®¾å¤‡åŒæ­¥</option>
            </select>
            
            <button onclick="saveRecord()">ä¿å­˜å¹¶æäº¤</button>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•
        window.onload = () => {
            if (!localStorage.getItem('userId')) {
                alert("è¯·å…ˆç™»å½•ï¼");
                window.location.href = 'login.html';
            }
        };

        async function saveRecord() {
            const healthType = document.getElementById('healthType').value;
            const healthValue = document.getElementById('healthValue').value;
            const recordWay = parseInt(document.getElementById('recordWay').value);
            const userId = localStorage.getItem('userId'); 

            if (!healthValue) {
                alert("è¯·è¾“å…¥æŒ‡æ ‡æ•°å€¼ï¼");
                return;
            }

            const data = {
                userId: parseInt(userId),
                healthType: healthType,
                healthValue: healthValue,
                recordWay: recordWay
            };

            try {
                const res = await fetch('http://localhost:8080/api/health/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!res.ok) throw new Error("æœåŠ¡å™¨å“åº”é”™è¯¯");
                const result = await res.json();

                if (result.code === 200) {
                    alert("âœ… æ·»åŠ æˆåŠŸï¼");
                    window.location.href = 'home.html';
                } else {
                    alert("âŒ ä¿å­˜å¤±è´¥ï¼š" + (result.message || "æœªçŸ¥é”™è¯¯"));
                }
            } catch (error) {
                console.error("æäº¤å¤±è´¥:", error);
                alert("æ— æ³•è¿æ¥åˆ°åç«¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚");
            }
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>